@echo off
setlocal EnableDelayedExpansion

echo ====================================================
echo    –õ–û–ö–ê–õ–¨–ù–´–ô –ü–ê–†–°–ò–ù–ì + –û–¢–ü–†–ê–í–ö–ê –ù–ê DOCKER –°–ï–†–í–ï–†
echo ====================================================
echo.

:: –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É –ø–∞—Ä—Å–µ—Ä–∞
cd /d "%~dp0"

:: –ü—Ä–æ–≤–µ—Ä—è–µ–º Python
python --version >nul 2>&1
if errorlevel 1 (
    echo ‚ùå Python –Ω–µ –Ω–∞–π–¥–µ–Ω! –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python –∏ –¥–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ PATH
    echo.
    pause
    exit /b 1
)

echo üêç Python –Ω–∞–π–¥–µ–Ω
echo.

:: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å Docker —Å–µ—Ä–≤–µ—Ä–æ–º
echo üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å Docker —Å–µ—Ä–≤–µ—Ä–æ–º...
python upload_to_docker.py --test-connection
if errorlevel 1 (
    echo.
    echo ‚ùå –ù–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Docker —Å–µ—Ä–≤–µ—Ä—É!
    echo    –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Docker —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 5000
    echo.
    echo üöÄ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å Docker —Å–µ—Ä–≤–µ—Ä –∫–æ–º–∞–Ω–¥–æ–π:
    echo    docker-compose up -d
    echo.
    pause
    exit /b 1
)

echo ‚úÖ Docker —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω
echo.

:: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
echo üìÅ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö...
python upload_to_docker.py --status
echo.

:: –°–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á—Ç–æ –¥–µ–ª–∞—Ç—å
echo ====================================================
echo –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:
echo.
echo 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ (1 —Ç–æ–≤–∞—Ä —Å –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
echo 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ (5 —Ç–æ–≤–∞—Ä–æ–≤ —Å –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏) 
echo 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ (10 —Ç–æ–≤–∞—Ä–æ–≤ —Å –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
echo 4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ Docker —Å–µ—Ä–≤–µ—Ä
echo 5. –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
echo 6. –í—ã—Ö–æ–¥
echo.
set /p choice="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä (1-6): "

if "%choice%"=="1" goto parse_local_1
if "%choice%"=="2" goto parse_local_5
if "%choice%"=="3" goto parse_local_10
if "%choice%"=="4" goto upload_existing
if "%choice%"=="5" goto show_status
if "%choice%"=="6" goto end

echo ‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä!
pause
goto end

:parse_local_1
echo.
echo üîÑ –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ (1 —Ç–æ–≤–∞—Ä —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)...
echo ====================================================
python local_dns_parser.py --limit 1 --headless
if errorlevel 1 (
    echo ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ!
    pause
    goto end
)
goto upload_after_parsing

:parse_local_5
echo.
echo üîÑ –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ (5 —Ç–æ–≤–∞—Ä–æ–≤ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)...
echo ====================================================
python local_dns_parser.py --limit 5 --headless
if errorlevel 1 (
    echo ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ!
    pause
    goto end
)
goto upload_after_parsing

:parse_local_10
echo.
echo üîÑ –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ (10 —Ç–æ–≤–∞—Ä–æ–≤ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)...
echo ====================================================
python local_dns_parser.py --limit 10 --headless
if errorlevel 1 (
    echo ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ!
    pause
    goto end
)
goto upload_after_parsing

:upload_after_parsing
echo.
echo ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω!
echo.
echo üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ Docker —Å–µ—Ä–≤–µ—Ä...
echo ====================================================
python upload_to_docker.py --upload --cleanup
if errorlevel 1 (
    echo ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –Ω–∞ Docker —Å–µ—Ä–≤–µ—Ä!
    pause
    goto end
)

echo.
echo üéâ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ Docker —Å–µ—Ä–≤–µ—Ä!
echo.
goto show_final_status

:upload_existing
echo.
echo üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ Docker —Å–µ—Ä–≤–µ—Ä...
echo ====================================================
python upload_to_docker.py --upload
if errorlevel 1 (
    echo ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –Ω–∞ Docker —Å–µ—Ä–≤–µ—Ä!
    pause
    goto end
)

echo.
echo üéâ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ Docker —Å–µ—Ä–≤–µ—Ä!
echo.
goto show_final_status

:show_status
echo.
echo üìä –°—Ç–∞—Ç—É—Å –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
echo ====================================================
python upload_to_docker.py --status
echo.
pause
goto end

:show_final_status
echo üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ Docker —Å–µ—Ä–≤–µ—Ä–µ...
echo ====================================================
python check_server_data.py
echo.

echo ‚úÖ –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–µ–Ω!
echo    –î–∞–Ω–Ω—ã–µ —Å–ø–∞—Ä—Å–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ Docker —Å–µ—Ä–≤–µ—Ä
echo.
pause

:end
echo.
echo –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!
pause 